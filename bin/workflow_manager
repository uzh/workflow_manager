#!/usr/bin/env ruby
# encoding: utf-8

require 'workflow_manager'

opt = OptionParser.new do |o|
  o.banner = "Usage:\n #{File.basename(__FILE__)} -d [druby://host:port] -m [development|production]"
  o.on(:server, 'druby://localhost:12345', '-d server', '--server', 'workflow manager URI (default: druby://localhost:12345)')
  o.on(:mode, 'development', '-m mode', '--mode', 'development|production (default: development)')
  o.parse!(ARGV)
end

uri = opt.server
if opt.mode =~ /[development|production]/
  config = File.join(File.dirname(File.expand_path(__FILE__)), "../config/environments/#{opt.mode}.rb")
  opt.mode = nil unless File.exist?(config)
end
print "mode = #{opt.mode}\n"
if opt.mode
  require File.join("workflow_manager/../../config/environments", opt.mode )
end
DRb.start_service(uri, WorkflowManager::Server.new) 
puts DRb.uri
DRb.thread.join
